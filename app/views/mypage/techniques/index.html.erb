<% content_for(:title, t(".title")) %>
<div
  class="drawer drawer-end min-h-screen px-4 py-6 bg-base-100 space-y-6"
  data-controller="step-guide drawer"
>
  <input type="checkbox" class="drawer-toggle" data-drawer-target="toggle">

  <div class="drawer-content">
    <div class="flex items-center space-x-2 m-4">
      <h1 class="text-3xl font-bold ml-8"><%= t(".title") %></h1>
      <div class="tooltip" data-tip="<%= t('defaults.start_guide') %>" data-action="click->step-guide#startTechniqueGuide">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
        </svg>
      </div>
    </div>

    <div id="step0" class="hidden" data-intro-text="こちらは、柔術のテクニックが一覧として並んでいる画面です。"></div>

    <div class="flex flex-col items-center justify-center gap-3">
      <%= link_to t("defaults.create") , new_mypage_technique_path, class: "btn btn-primary btn-wide", id: "step1", data: { title_text: "新規作成", intro_text: "一覧にないテクニックは、こちらのボタンから新規作成することができます。" } %>
      <%= search_form_for @q, url: mypage_techniques_path, id: "step2", class: "w-80",
            data: { turbo_frame: "technique-list",
                    controller: "instant-search",
                    action: "input->instant-search#autosubmit",
                    title_text: "検索",
                    intro_text: "一覧にあるテクニックは、ここから検索して表示を絞り込むことができます。"
            } do |f| %>
        <label class="input">
          <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <g
              stroke-linejoin="round"
              stroke-linecap="round"
              stroke-width="2.5"
              fill="none"
              stroke="currentColor"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.3-4.3"></path>
            </g>
          </svg>
          <%= f.search_field :name_ja_or_name_en_or_note_cont, placeholder: t("defaults.search"), class: "search" %>
        </label>
      <% end %>
    </div>

    <div id="step3" data-title-text="テクニック詳細" data-intro-text="カードをクリックすると、テクニック個々の詳細を確認・編集することができます。" class="hidden"></div>
    <div id="step4" data-title-text="テクニック詳細" data-intro-text="こちらのノート欄に、日々の練習で気がついたことを記録していきましょう！" class="hidden"></div>
    <div
      id="step5"
      data-intro-text="こちらの画面の説明は以上です。<br><br>本画面から確認できるテクニック同士を繋げて可視化する操作について知りたい場合は <a class='underline font-bold' href=<%= mypage_chart_path(@chart) %>>Flow Chart</a> メニューの左上にある
        <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='size-6 inline'>
          <path stroke-linecap='round' stroke-linejoin='round' d='M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z' />
        </svg>
      をクリックしてください！"
      class="hidden"
    >
    </div>

    <%= turbo_frame_tag "technique-list" do %>
      <div class="space-y-2 max-w-screen-2xl mx-auto mt-10">
        <% if @techniques.present? %>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2 max-w-screen-2xl mx-auto">
          <% @techniques.each do |t| %>
            <article class="relative bg-base-200 shadow-md rounded-box p-4 space-y-3">
              <div class="items-start space-y-2 flex flex-col">
                <% case t.category %>
                <% when "submission" then %>
                  <span class="badge badge-soft bg-red-100"><%= t("enums.category.#{t.category}") %></span>
                <% when "sweep" then %>
                  <span class="badge badge-soft bg-blue-100"><%= t("enums.category.#{t.category}") %></span>

                <% when "pass" then %>
                  <span class="badge badge-soft bg-green-100"><%= t("enums.category.#{t.category}") %></span>

                <% when "guard" then %>
                  <span class="badge badge-soft bg-gray-100"><%= t("enums.category.#{t.category}") %></span>

                <% when "control" then %>
                  <span class="badge badge-soft bg-purple-100"><%= t("enums.category.#{t.category}") %></span>

                <% when "takedown" then %>
                  <span class="badge badge-soft bg-orange-100"><%= t("enums.category.#{t.category}") %></span>
                <% else %>
                  <span class="badge badge-soft"><%= t.category ? t("enums.category.#{t.category}") : t("enums.category.nil") %></span>
                <% end %>
                <span class="text-lg font-medium" ><%= t.name_ja %></span>
              </div>

              <% if t.note.present? %>
                <p class="text-sm text-base-content/70 line-clamp-3 break-words"><%= t.note %></p>
              <% end %>

              <!-- カード全面クリックでdrawerを開く & 中身を読み込む（stretched-link的アンカー） -->
              <%= link_to edit_mypage_technique_path(t),
                    class: "absolute inset-0 z-10",
                    data: { turbo_frame: "technique-drawer", action: "click->drawer#open" } do %>
                <span class="sr-only">Open the editing panel</span>
              <% end %>
            </article>
          <% end %>
          </div>
        <% else %>
          <div class="mt-10">
            <p><%= t(".nothing_here") %></p>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- ドロワー右側 -->
  <div class="drawer-side z-50">
    <!-- 背景クリックで閉じる -->
    <label class="drawer-overlay" data-action="click->drawer#close"></label>
    <!-- パネル本体（SP=全幅, PC=28rem） -->
    <aside class="bg-base-200 w-full sm:w-[28rem] max-w-[90vw] h-full overflow-y-auto" role="dialog" aria-modal="true">
      <div class="flex flex-end justify-between p-3">
        <h2 class="text-lg font-bold mr-2"><%= t(".editing_panel_title") %></h2>
        <!-- ✕ボタン（クリックで閉じる） -->
        <label class="btn btn-sm btn-circle btn-ghost " data-action="click->drawer#close">✕</label>
      </div>
      <!-- Turbo Frame: ここに edit 部分を差し替え表示 -->
      <%= turbo_frame_tag "technique-drawer" do %>
        <!-- empty here until a card is clicked -->
      <% end %>
    </aside>
  </div>
</div>
